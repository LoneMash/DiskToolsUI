<Window x:Class="DiskToolsUi.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:DiskToolsUi.Converters"
        Title="{Binding WindowTitle}" 
        Icon="/Icons/app.ico"
        Height="600" Width="900"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:TypeToVisibilityConverter x:Key="TypeToVisibilityConverter"/>
        
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#F1F1F1"/>
            <Setter Property="BorderBrush" Value="#3F3F46"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3E3E42"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#007ACC"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border Background="#1E1E1E" CornerRadius="8" BorderBrush="#007ACC" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="30"/>
            </Grid.RowDefinitions>

            <!-- BARRE DE TITRE CUSTOM -->
            <Border Grid.Row="0" Background="#007ACC" CornerRadius="8,8,0,0" 
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
                        <TextBlock Text="⚡" FontSize="20" Foreground="White" 
                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="Disk Tools UI" FontSize="14" FontWeight="SemiBold" 
                                   Foreground="White" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,5,0">
                        <Button Content="─" Width="40" Height="30" 
                                Background="Transparent" Foreground="White" 
                                BorderThickness="0" FontSize="16" FontWeight="Bold"
                                Click="MinimizeButton_Click" Cursor="Hand"/>
                        <Button Content="✕" Width="40" Height="30" 
                                Background="Transparent" Foreground="White" 
                                BorderThickness="0" FontSize="14" FontWeight="Bold"
                                Click="CloseButton_Click" Cursor="Hand">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#E81123"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- CONTENU PRINCIPAL -->
            <Grid Grid.Row="1" Margin="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- SIDEBAR GAUCHE -->
                <Border Grid.Column="0" Background="#252526" BorderBrush="#3F3F46" BorderThickness="0,0,1,0">
                    <StackPanel Margin="15">
                        <TextBlock Text="ACTIONS" FontSize="12" FontWeight="Bold" 
                                   Foreground="#808080" Margin="0,0,0,10"/>
                        
                        <ItemsControl ItemsSource="{Binding Actions}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding Name}" 
                                            Style="{StaticResource ModernButton}"
                                            Command="{Binding DataContext.ExecuteActionCommand, 
                                                     RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Margin="0,0,0,8"
                                            HorizontalAlignment="Stretch"
                                            HorizontalContentAlignment="Left"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- ZONE PRINCIPALE DROITE -->
                <Grid Grid.Column="1" Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- ZONE PARAMÈTRES - TextBox simple, dynamique depuis config.json -->
<Border Grid.Row="0" Background="#2D2D30" CornerRadius="4"
        Padding="15" Margin="0,0,0,15" BorderBrush="#3F3F46" BorderThickness="1">
    <StackPanel>
        <TextBlock Text="PARAMÈTRES" FontSize="12" FontWeight="Bold"
                   Foreground="#808080" Margin="0,0,0,10"/>

        <ItemsControl ItemsSource="{Binding Parameters}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="{Binding Label}" Foreground="#F1F1F1"
                                   VerticalAlignment="Center" Width="130" Margin="0,0,10,0"/>
                        <TextBox Text="{Binding CurrentValue, UpdateSourceTrigger=PropertyChanged}"
                                 Width="200" Height="30"
                                 Background="#3F3F46" Foreground="#F1F1F1"
                                 BorderBrush="#007ACC" BorderThickness="1"
                                 Padding="8,5" FontSize="13"/>
                    </StackPanel>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </StackPanel>
</Border>

                    <!-- ZONE RÉSULTATS -->
                    <Border Grid.Row="1" Background="#2D2D30" CornerRadius="4" 
                            Padding="15" BorderBrush="#3F3F46" BorderThickness="1">
                        <Grid>
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <TextBlock Text="RÉSULTATS" FontSize="12" FontWeight="Bold" 
                                               Foreground="#808080" Margin="0,0,0,10"/>
                                    
                                    <ItemsControl ItemsSource="{Binding Results}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="0,5">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="150"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{Binding Label}" 
                                                               Foreground="#CCCCCC" FontWeight="SemiBold"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding Value}" 
                                                               Foreground="#F1F1F1" TextWrapping="Wrap"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- BARRE DE STATUS -->
            <Border Grid.Row="2" Background="#252526" BorderBrush="#3F3F46" BorderThickness="0,1,0,0">
                <TextBlock Text="{Binding StatusMessage}" Foreground="#CCCCCC" 
                           Margin="10,5" VerticalAlignment="Center" FontSize="11"/>
            </Border>

            <!-- OVERLAY CHARGEMENT -->
            <Grid Grid.RowSpan="3" Background="#AA000000" 
                  Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="⚡" FontSize="48" Foreground="#007ACC" 
                               HorizontalAlignment="Center" Margin="0,0,0,10">
                        <TextBlock.RenderTransform>
                            <RotateTransform x:Name="LoadingRotation" CenterX="24" CenterY="24"/>
                        </TextBlock.RenderTransform>
                        <TextBlock.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimation Storyboard.TargetName="LoadingRotation"
                                                       Storyboard.TargetProperty="Angle"
                                                       From="0" To="360" Duration="0:0:2"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </TextBlock.Triggers>
                    </TextBlock>
                    <TextBlock Text="Chargement en cours..." FontSize="16" 
                               Foreground="White" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>
